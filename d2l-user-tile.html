<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../d2l-icons/d2l-icons.html">
<link rel="import" href="../d2l-tile/d2l-tile.html">
<link rel="import" href="icons.html">
<link rel="import" href="../d2l-image/d2l-image.html">

<dom-module id="d2l-user-tile">
	<template>
		<style>
			:host {
				width: 350px;
				height: 350px;
				text-align: center;
				cursor: pointer;
				display: block;
				position: relative;
			}

			.user-tile-avatar {
				width: 80px;
				height: 80px;
				border: 2px white solid;
				border-radius: 14px;
				margin: -40px auto 19px auto;
				background-color: white;
				overflow: hidden;
			}

			.user-tile-items {
				padding-left: 20px;
				padding-right: 20px;
				text-align: left;
			}

			[hidden] {
				display: none;
			}

			.user-tile-default-icon {
				--d2l-icon-height: 100%;
				--d2l-icon-width: 100%;
			}

			.user-tile-grade {
				font-weight: bold;
			}

			.user-tile-information-wrapper {
				@apply --d2l-body-compact-text;
			}

			.user-tile-name {
				font-size: 1.25rem;
				font-weight: bold;
				margin: 0 auto;
			}

			.user-tile-school {
				margin-top: 4px;
				font-size: 0.7rem;
			}

			.user-tile-school:not([hidden]) {
				display: flex;
				justify-content: center;
			}

			.grade-divider {
				margin: 0 4px;
			}

			d2l-tile {
				--tile-image-height: 100px;
				min-height: 100%;
				width: 100%;
				margin: 0;
			}
		</style>

		<d2l-tile img-url="[[background]]" style$="[[_createBackgroundStyle(backgroundColor)]]">
			<div class="user-tile-avatar">
				<template is="dom-if" if="{{_hideCustomIcon(icon)}}">
					<d2l-icon icon="navigation-48:profile" class="user-tile-default-icon"></d2l-icon>
				</template>
				<template is="dom-if" if="{{!_hideCustomIcon(icon)}}">
					<d2l-image
						image-url="[[icon]]"
						token="[[token]]"
					></d2l-image>
				</template>
			</div>
			<div class="user-tile-information-wrapper">
				<p class="user-tile-name">[[name]]</p>
				<p hidden="[[grade]]" class="user-tile-school">[[school]]</p>
				<p hidden="[[!grade]]" class="user-tile-school">
					<span class="user-tile-grade">[[grade]]</span> <span class="grade-divider">-</span> <span>[[school]]</span>
				</p>
				<div class="user-tile-items">
					<slot></slot>
				</div>
			</div>
		</d2l-tile>
	</template>
	<script>
	'use strict';

	Polymer({
		is: 'd2l-user-tile',
		properties: {
			name: String,
			school: String,
			background: String,
			backgroundColor: String,
			grade: { type: String, value: null },
			icon: {
				type: String,
				value: null
			},
			token: {
				type: String,
				value: null
			}
		},
		listeners: {
			'd2l-image-failed-to-load': '_onImageLoadFailure'
		},
		_hideCustomIcon: function(icon) {
			return !icon;
		},
		_createBackgroundStyle: function(backgroundColor) {
			this.customStyle['--tile-image-background'] = backgroundColor || '';
			this.updateStyles();
		},
		_onImageLoadFailure: function() {
			this.icon = null;
		}
	});
	</script>
</dom-module>
